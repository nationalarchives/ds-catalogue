{% extends 'base.html' %}

{% from 'components/pagination/macro.html' import tnaPagination %}

{%- set pageTitle = (record.summary_title or '[No title]') | striptags -%}

{% block stylesheets %}
{{ super() }}
    <link rel="stylesheet" href="{{ static('record-details.css') }}?v={{ app_config.BUILD_VERSION }}" media="screen,print">
{% endblock %}

{% block content %}
<div class="tna-section">
  <div class="tna-container">
    <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny">
      <hgroup class="tna-hgroup-xl">
        <p class="tna-hgroup__supertitle">Item</p>
        <h1 class="tna-hgroup__title">{{ pageTitle }}</h1>
      </hgroup>

      {% if canonical %}
      <p>Canonical: {{ canonical }}</p>
      {% endif %}

      <ol class="tna-ol">
        <li>
          Held at:
          <a href="{{ record.held_by_url }}">{{ record.held_by | safe }}</a>
        </li>
        {% for hierarchy_record in record.hierarchy %}
        <li>
          {{ hierarchy_record.level }}:
          <a href="{{ hierarchy_record.url }}">{{ hierarchy_record.summary_title }}</a>
        </li>
        {% endfor %}
      </ol>

      <ul class="tna-ul">
      Legacy Breadcrumb Items for short hierarchy items:
      {%- set bci = record.breadcrumb_items -%}  
      {% for bc_item in bci %}
        {% if bc_item.url %}
          {% if bc_item.iaid == record.iaid %}
              {%- set is_current_item = True -%}
          {% else %}
              {%- set is_current_item = False -%}
          {% endif %}
          {# is_current_item = {{ is_current_item }} #}
          <li>
          <a href="{{ bc_item.url }}">{{ bc_item.level }}</a>
          </li>
        {% endif %}
      {% endfor %}
      </ul>

      <h2 class="tna-heading-l">Record details</h2>
      {% set fields = [
        'title',
        'reference_number',
        'closure_status',
        'date_covering',
        'description',
        'held_by',
        'legal_status',
        'closure_status',
        'dimensions',
        'creator'
      ] %}
      <dl class="tna-dl tna-dl--plain tna-dl--dotted">
        {% for field in fields %}
        {% if record[field] %}
        <dt>
          <span class="record-details__label">
            {{ field_labels[field].title }}
            {% if field_labels[field].description %}
            <span class="record-details__description">
              <span class="tna-visually-hidden">(</span>{{ field_labels[field].description }}<span class="tna-visually-hidden">)</span>
            </span>
            {% endif %}
          </span>
        </dt>
        <dd>
          {% if field == 'held_by' %}
          <a href="{{ record.held_by_url }}">{{ record[field] | safe }}</a>
          {% elif field in ['creator'] %}
          {# Show a list of items #}
          <ul class="tna-ul">
            {% for item in record[field] %}
            <li>{{ item }}</li>
            {% endfor %}
          </ul>
          {% else %}
          {{ record[field] | safe }}
          {% endif %}
        </dd>
        {% endif %}
        {% endfor %}
      </dl>

      {% set previous = None %}
      {% set next = None %}

      {% if record.previous %}
      {% set previous = {
        'text': 'Previous ' + record.previous.level + ': ' + record.previous.reference_number,
        'href': record.previous.url
      } %}
      {% endif %}

      {% if record.next %}
      {% set next = {
        'text': 'Next ' + record.next.level + ': ' + record.next.reference_number,
        'href': record.next.url
      } %}
      {% endif %}

      {% if previous or next %}
      {{ tnaPagination({
        'previous': previous,
        'next': next,
        'spaced': True,
        'solid': True
      }) }}
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
