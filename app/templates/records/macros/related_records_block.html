{% from 'components/card/macro.html' import tnaCard %}

{% macro related_records_block(record, related_records) %}
  {# Only display if there are related records #}
  {% if related_records %}
    <div class="tna-section">
      <div class="tna-container">
        <div class="tna-column tna-column--full tna-!--margin-top-l">
          <h2 class="tna-heading-l">Related records</h2>
          <p>Records that share similar topics with this record.</p>
        </div>
      </div>
      <div class="tna-container related-records">
        {% for related_record in related_records %}
          <div class="tna-column tna-column--width-1-3 tna-column--full-small tna-column--full-tiny tna-!--margin-top-m">
            {%- set cardContent %}
              <div>
                <p><strong>Catalogue reference:</strong> {{ related_record.reference_number }}</p>
                {% if related_record.date_covering %}
                  <p class="tna-!--no-margin-top"><strong>Date:</strong> {{ related_record.date_covering }}</p>
                {% endif %}
                {% if related_record.clean_description %}
                  <p>{{ related_record.clean_description | striptags | truncate(150) }}</p>
                {% elif related_record.description %}
                  <p>{{ related_record.description | striptags | truncate(150) }}</p>
                {% endif %}
              </div>
            {%- endset %}
            {{ tnaCard({
              'supertitle': related_record.level,
              'title': related_record.summary_title | striptags,
              'headingLevel': 3,
              'href': related_record.url,
              'body': cardContent,
              'style': 'contrast',
              'fullAreaClick': True
            }) }}
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endmacro %}